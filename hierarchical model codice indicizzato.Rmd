---
title: "hierarchical model indicizzato senza model selection"
author: "Lorenzo Ricciardulli"
date: "2024-07-10"
output: html_document
---

```{r}

X = as.matrix(data_X)
vettore <- matrix(1, nrow = 768, ncol = 1)
X = cbind(vettore,X)
A = X[,c(1,4,7,8,9)] ## non correlati
B = X[,c(2,3,5,6)]  # correlati
q = ncol(A)   ## non correlati
t = ncol(B)    # correlati
X = cbind(A,B)
P = ncol(X)
W <- cov(B)# Scale matrix for the Wishart distribution
W = solve(W)
df <- 40
jags_model_string <- function() {
  return("
    model {
      # Likelihood
      for (i in 1:N) {
        y[i] ~ dnorm(mu[i], tau)
        mu[i] <- inprod(X[i,], beta)
      }

      # Priors for non-correlated betas
      for (j in 1:5) {
        beta[j] ~ dnorm(0,0.01)
      }

      # Priors for correlated betas
      beta[6:9] ~ dmnorm(mu_beta[6:9], Tau[6:9, 6:9])

      # Prior for the precision matrix Tau of correlated betas
      Tau[6:9, 6:9] ~ dwish(W[,], df)
      Sigma[6:9, 6:9] <- inverse(Tau[6:9, 6:9])  # Covariance matrix of correlated betas

      # Hyperpriors for the mean and covariance of correlated betas
      for (j in 6:9) {
        mu_beta[j] <- 0
      }

      # Prior for the observation precision
      tau ~ dgamma(0.01, 0.01)
      sigma2 <- 1/tau  # Observation variance
    }
  ")
}

################### initiate values

inits <- function() {
  list(
    beta = rnorm(P, 0, 1),
    tau = rgamma(1, 0.1, 0.1)
  )
}

data_jags <- list(N = nrow(X), P = ncol(X), X = X, W = W, df = df)

#########################################################################
## Specify for which parameters we want to perform posterior inference ##
#########################################################################

parameters <- c("beta")


####################################
## Finally, run the jags function ##
####################################


model_string <- jags_model_string()
model <- jags.model(textConnection(model_string), data = data_jags, inits = inits, n.chains = 1)
update(model, 1000)  # Burn-in
samples <- coda.samples(model, variable.names = parameters, n.iter = 1000)
beta_post = coda.samples(model, variable.names = "beta", n.iter = 1000)

# Stampa il sommario dei risultati
print(summary(samples))
traceplot(beta_post)

```

```

